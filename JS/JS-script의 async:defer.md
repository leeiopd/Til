# JS - script 의 async와 defer 속성

> html을 랜더링하는 과정에서 `css(<link type="text/css">)` 또는 `js(<script)` 를 만나면 동기적으로 처리한다.
>
> 내용이 해석되고 실행되기 전 뒤에 나오는 내용을 처리하지 않는다.
>
> 이러한 처리 방식은 화면의 랜더링속도에 큰 영향을 줄 수 있다.
>
> JS의 경우 대부분 호면 출력보다는 기능적 처리에 관련된 경우가 많고, 화면의 출력에 직접적인 연관이 있을 경우라도 기본적인 화면이 출력된 이후에 처리되는것이 유리하기때문에 처리를 지연하는 것이 유리하다.
>
> 이러한 이유로 `css`는 `<head>` 영역에 `js` 는 `</body>` 바로 앞에 선언하는것을 추천한다.
>
> 하지만, 이 방법 이외에도 `<script>` 의 `async` 속성과 `defer` 속성을 사용하는 방법이 있다.



### 일반적인 실행

- 기본적으로 `<script>` 는 인라인 코드의 경우 즉시 해석되고 실행 될 수 있지만, 그렇지 않은 경우 해당파일을 가져올 때 가지 HTML 문서의 구문 분석을 중단한다.
- 이는 HTML이 화면에 출력되는 시간을 길어지게 만들 수 있다.



### async 속성이 추가된 경우의 실행

- `async`  속성은 브라우저에 스크립트 파일이 비동기적으로 실행될 수 있음을 나타내기 위해 사용한다.

- HTML 구문 분석기는 `<scirpt>` 태그에 도달한 지점에서 스크립트를 가져오고 실행하기 위해 일시 중지할 필요가 없다.

- 따라서, HTML 구문 분석과 병행하여 스크립트를 가져온 후, 스크립트가 준비 될 때마다 즉시 실행하능하다.

- 실행 순서가 다운로드의 완료 시점에 결정되므로, 실행 순서가 중요한 스크립트들에 `async` 사용시에는 유의 해야 한다.

  - HTML 5 spec 에 `async=false` 속성 지정시 호출 순서대로 실행되도록 추가 됨 (default = true)

  

```javascript
<script async src="script.js">
```

* 이 속성은 외부 스크립트 파일에서만 사용할 수 있다.
- HTML 문서가 여전히 구문 분석되는 동안 파일을 다운로드 할 수 있다.

- 다운로드가 완료 되면 스크립트가 실행 될 수 있도록 구문분석이 일시 중지된다.



### defer 속성이 추가된 경우의 실행

- `defer` 속성은 HTML 구문 분석이 완료되면, 스크립트 파일을 실행한다.



```javascript
<script async src="script.js">
```

* 이 속성은 외부 스크립트 파일에서만 사용할 수 있다.
* HTML 구문 분석이 실행되는 동안, 파일을 다운로드 할 수 있다.
* 그러나 HTML 구문 분석이 완료되기 전에는 스크립트 다운로드가 완료 되더라도 구문 분석이 완료 될 때가지 스크립트는 실행되지 않는다.
* async와 다르게 호출된 순서대로 실행 된다.



### 사용

* `<script>` 요소의 위치
  * `<script>` 요소가 문서 맨끝에 있지 않으면 스크립트의 비동기 및 지연 실행이 더 중요하다.
  * HTML 문서는 `<html>` 요소부터 닫히는 순서로 파싱 된다.
    * 외부 소스 JavaScript 파일이 닫는 `</body>` 요소 바로 앞에 있으면, `async` 또는 `defer` 속성을 사용하는 것이 큰 효과가 없다.
    * HTML 파서가 그 시점까지 문서의 대다수를 완성 했기 때문에, 지연에 큰 의미가 없어진다.



* 스크립트 자체의 포함 여부
  * 다른 파일들에 종속적이지 않거나, 종속성 자체가 없는 스크립트 파일의 경우 `async` 속성이 유용하다.
  * 파일이 어느 지점에서 실행되는지 정확히 알 필요가 없기 때문에 비동기 로드가 가장 적합하다.



* 스크립트가 완전히 구문 분석된 DOM에 의존하는지 여부
  * 대부분의 경우 스크립트 파일에는 DOM과 상호작용이 필요한 기능이 포함되어 있거나, 페이지에 포함된 다른 파일에 대한 종속성이 있을 수 있다.
    * 이러한 경우, 스크립트를 실행하기 전에 DOM이 완전히 해석되어야 정상적인 동작을 할 수 있다.
    * 일반적인 경우에는 이러한 스크립트 파일은 페이지의 맨 아래에 배치되어 모든 내용이 파싱된 후 동작하도록 해야 한다.
  * 어떤 이유든, 파일을 다른 위치에 배치해야 하는 상황에서는 `defer` 속성을 사용할 수 있다.



* 스크립트가 작고 종속성을 가질 때
  * 스크립트가 비교적 작고 다른 파일에 의존하는 경우 인라인으로 정의하는것이 더 융용 할수 있다.
  * 인라인 사용시, HTML 문서의 구문 분석이 차단되지만 크기가 작으면 큰 문제가 되지 않는다.
  * 다른 파일에 의존하는 경우 차단이 필요 할 수 있다.

