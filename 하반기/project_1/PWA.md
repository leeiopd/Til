# PWA

## Progressive web Apps

> PWA는 최고의 웹(web)과 최고의 앱(app)을 결합한 경험이다. 브라우저를 통해 처음 방문한 사용자에게 유용하며, 설치가 필요하지 않다. 
>
> 사용자가 PWA와 관계를 점진적으로 형성할수록 성능이 더욱 강력해 질 것이다.
>
> 느린 네트워크에서도 빠르게 로드되고, 관련된 푸시 알림을 전송한다. 
>
> 모바일 앱처럼 전체 화면으로 로드되고, 홈 화면에 아이콘이 있다.



### PWA란?

* 진화 : 점진적인 개선을 통해 작성되므로, 어떤 브라우저를 선택하든 상관없이 모든 사용자에게 적합하다
* 반응형 : 데스크톱, 태블릿, 모바일 등 모든 폼팩터에 맞게 보여집니다
* 연결 독립적 : 오프라인이나 느린 네트워크에서도 작동(로컬 기기의 캐시에서 로드)
* 앱과 유사 : 앱 스타일의 상호작용 및 탐색 기능을 사용자에게 제공
* 최신 상태
* 안전 : HTTPS를 통해 제공됨
* 검색 가능 : 구글과 같은 검색 포탈에 검색결과에 노출됩니다. 
* 재참여 가능 : 푸시 알림 같은 기능 가능
* 설치 필요 없음(다운로드 필요 없음) : 앱 스토어 등록이 필요 없음
* 링크 연결 가능 : URL을 통해 손쉽게 공유할 수 있음



### PWA의 사업성(가능성)

* PWA는 웹사이트이지만 설치된 애플리케이션과 같은 외형과 느낌을 가졌다.

* 에셋을 저장하고 성능을 높이는 `서비스 워커`라는 백그라운드 실행 스크립트를 이용한다.

* `서비스 워커`는 오프라인 실행 및  오프라인 스토리지 접근이 가능하고, 팝업 알람도 표시할 수 있다.

  ```
  > 서비스워커란
  
  서비스워커는 웹페이지와는 별개로 브라우저에 의해 백그라운드에서 실행되는 스크립트 기반의 워커(Worker)입니다.
  
  네트워크 요청을 가로채고, 응답을 조작하기 위한 프로그래밍 가능한 캐시를 제어할 수 있는 기능을 현재 크롬에서 제공합니다. 
  
  > 서비스워커의 생명주기
  
  서비스워커는 웹페이지와 완전하게 별개인 생명주기(Life Cycle)를 가지고 있으며, register를 통해 백그라운드에서 서비스워커의 설치 과정을 시작합니다.
  
  설치 과정에서 리소스를 캐싱하고자 할 때 모든 파일이 성공적으로 캐싱되고 나면 서비스워커는 설치 상태가 되지만 만약 어떠한 파일이라도 다운로드나 캐싱에 실패한다면, 설치 과정 역시 실패하고 서비스워커는 활성화되지 않습니다.
  
  설치가 이루어졌을 때 이어서 활성화 단계가 수행되며, 이는 우리가 서비스워커 갱신하기 섹션에서 다룰 기존 캐시의 관리를 위한 시점으로 활용할 수 있습니다.
  
  활성화 단계 후에 서비스워커는 페이지가 등록한 서비스워커는 범주(scope) 내에 닿는 모든 페이지를 제어하게 되며 페이지로부터 네트워크 요청이나 메세지가 생성될 때 발생하는 fetch와 message를 제어하게 됩니다.
  
  
  단순화한 서비스워커의 생명 주기
  
  > 서비스워커를 사용하기 위한 몇 가지 사항
  
  서비스워커는 지대한 영향을 줄 수 있는 서비스워커 모듈의 신뢰성을 위해 HTTPS 기반으로만 동작합니다. 또한, 현재 시점에서 캐시 시스템은 폴리필을 통해서만 사용할 수 있습니다.
  ```

*   CSS3, 자바스크립트를 비롯해 여러 표준 툴을 사용하므로 다른 브라우저와 플랫폼에 간단히 이식할 수 있다.
* 모바일용 PWA를 한번 개발하면 이를 다른 모든 기기에 배포할 수 있다.
*   PWA는 앱 같은 느낌이지만, 브라우저 상의 웹 페이지이므로 인덱싱과 공유가 가능하다.
* 설치해도 시스템 하드웨어에 전혀 액세스할 수 없기 때문에 상대적으로 안전하다. 



### **AMP와 PWA**

* PWA와 비슷한 기술로는 [구글의 ‘AMP’(Accelerated Mobile Pages) 프로젝트](http://navercast.naver.com/contents.nhn?rid=122&contents_id=114566)가 있다.

>인터넷의 발달은 우리에게서 참을성을 앗아가고 있다. 웹 콘텐츠를 보기 위해 수 초를 기다려야 할 때, 많은 사람은 기다리기보다 차라리 웹 콘텐츠 소비를 포기한다. 웹페이지 로딩 시간이 10초가 될 경우 이탈률은 무려 58%에 이른다는 연구 결과도 있다. 구글이 주창한 `AMP - Accelerated Mobile Pages`

**[네이버 지식백과]** [구글 AMP](https://terms.naver.com/entry.nhn?docId=3580523) - 모바일 페이지를 더 빠르게 (용어로 보는 IT, 채반석)



* AMP의 핵심은 모바일 웹 로딩 시간 단축이다. 프로젝트는 페이지 로딩 시간을 단축해서 긴 페이지 로딩 시간이 불러오는 사용자 이탈을 막고, 사용자에게 더 나은 콘텐츠 소비 경험을 제공하고자 한다.
* AMP의 작동 원리는 대략 3단계로 나뉜다. 핵심은 ‘캐싱’(Caching)이다.
  1. **페이지 구성 단순화**: 자바스크립트 코드를 최소화한다. 필요한 기능은 태그 컴포넌트로 만들어둔다. 구글은 ‘AMP 자바스크립트’라는 라이브러리를 제공한다.
  2. **대역폭 최적화**: 최적화된 해상도 이미지를 찾아 기기에 최적화된 콘텐츠를 노출하고, 비동기 로딩을 통해 뉴스 소비 경험을 개선한다. 비동기 로딩이란, 뉴스를 읽는 데 핵심이 되는 텍스트를 먼저 띄우고 용량이 큰 이미지를 나중에 받는 방식이다.
  3. **페이지 캐싱**: 구글은 AMP를 적용한 뉴스 데이터를 저장(캐싱)한다. 사용자가 뉴스를 읽겠다고 요청하면, 언론사의 서버가 아니라 미리 캐싱한 데이터를 보여줌으로써 로딩 시간을 획기적으로 줄인다.



### PWA의 요건

1. **HTTPS를 운영해야 한다.**
   * PWA는 운영체제의 여러 특별한 권한을 부여받기 때문에, 웹 서버와의 보안 연결은 필수다.
   * 이와 관련하여 도움이 필요하다면 [렛츠인크립트Let’s Encrypt라는 무료 SSL 서비스](https://letsencrypt.org/getting-started/)를 확인해 보기 바란다.

2. [**웹 앱 매니페스트Web App Manifest**](https://developer.mozilla.org/ko/docs/Web/Manifest)가 있어야 한다.
   * 이름만 보고 겁낼 필요는 없다. 단지 사이트와 관련된 정보를 담는 제이슨JSON 파일일 뿐이다.
   * 게다가 파비콘favicon 생성기를 사용한다면 기본 뼈대를 갖춘 매니페스트 파일이 이미 있을 것이다.
   * 브라우저나 검색 스파이더가 찾을 수 있도록 [웹 페이지 `head`부분에 `link`를 사용하여 참조](https://developer.mozilla.org/en-US/docs/Web/Manifest#Deploying_a_manifest_with_the_link_tag)시키면 된다.
3. **서비스 워커를 사용해야 한다.**
   * 아마도 이게 가장 복잡한 단계일 것이다.
   * 하지만 서비스 워커 관련해서는 엄청난 수의 가이드가 있어, 원하는 작업 유형에 맞는 제작 방법을 참고할 수 있다. 그 중에서도 특히 [모질라Mozilla에서 제공한 가이드](https://serviceworke.rs/)는 아주 훌륭하다.





### Project에 따른 PWA의 이점

* 정보 사이트

대개 이런 사이트는 우리가 누구인지, 우리의 사업이나 프로젝트가 무엇인지 사람들에게 알리는 용도다. 사용자들의 재방문이 잦은 사이트에 비해 서비스 워커의 오프라인 캐싱 기능으로 얻을 수 있는 성능상의 이점이 훨씬 적다. 또한 사용자가 이 PWA를 실제로 설치할 가능성도 매우 낮다.



PWA의 장점으로 흔히 내세우는 두 가지 ‘주요’ 기능, 즉 설치 기능과 오프라인 사용 기능이 정보 사이트에는 크게 해당되지는 않지만, 그럼에도 PWA를 채택하는 것은 여전히 유용하다. 그 두 가지 기능이 PWA의 전부가 아니기 때문이다. 사용자는 어떤 기기에서든 작동하며, 사용하기 쉽고, 검색 기능이 있으며, 친구와 쉽게 공유할 수 있는 사이트에 만족할 것이다.

 

* 정기 사이트

정기 사이트periodical site는 블로그, 뉴스레터, 팟캐스트부터 만화, 잡지, 신문기사, 동영상 프로그램까지 포함한다. 이는 정보 사이트와 비슷하지만, 정기적 또는 비정기적으로 계속 갱신되는 특징이 있다. 

이런 사이트에는 새 기사를 읽기 위해, 새 동영상을 보기 위해, 새 팟캐스트 에피소드를 듣기 위해 주기적으로 방문하는 사용자가 있다. 정기 사이트는 정보 사이트의 DNA를 공유하므로, 정보 사이트가 갖는 PWA의 이점을 그대로 포함한다. 그러나 정기 사이트만이 취할 수 있는 이점도 있다.

푸시 알림은 사용자의 기기에 설치된 어떤 서비스 워커 인스턴스에도 서버로부터 갱신 사항을 전송할 수 있는 메커니즘을 제공한다. 또한 사용자가 권한만 허용했다면 설치된 PWA나 브라우저가 실행되고 있지 않아도 알림을 띄울 수 있다.

 

* 트랜잭션 사이트

사용자와의 정보 교환이 가능한 모든 사이트를 트랜잭션 사이트라고 할 수 있다. 가장 흔한 예로 온라인 쇼핑몰, 뱅킹, 주식 거래, 여행 예약, 공과금 납부 포털 등이 있다. PWA는 이미 이 분야에서 자신의 가치를 충분히 증명해 왔다. 

사용자의 방문이 빈번한(매우 상대적인 표현이지만) 트랜잭션 사이트라면, PWA의 설치 기능이 매우 큰 기능을 한다.  실행되고 있는 브라우저의 부가 기능도 없으므로 오버헤드도 적다. 이 모든 이점이 함께 작용하여 능률적이고 마찰 없는 사용자 경험이 완성된다.

 

* 소셜 서비스

트위터Twitter나 페이스북Facebook 같은 소셜 웹사이트는 PWA의 훌륭한 후보다. 사실 [트위터는 이미 PWA의 길로 들어갔다.](https://lite.twitter.com/) 소셜 사이트는 정기 사이트와 트랜잭션 사이트의 측면이 조합된 사이트로, 자연스럽게 그 두 원형이 갖는 PWA의 이점을 모두 포함한다. 이런 종류의 사이트에서는 특히 [푸시 알림](https://developer.mozilla.org/ko/docs/Web/API/Push_API)이 필수인데, 사용자의 재방문이 장기적인 성공을 좌우하기 때문이다. 그런 점에서 설치 기능 또한 중요하다.

성능, 특히 초기 실행 속도는 소셜 프로젝트에서 중요한 벤치마크 대상이다. 사용자는 이미지와 동영상을 포함한 콘텐츠가 로딩될 때까지 한가로이 앉아서 기다리지 않기 때문이다. 사이트의 자원을 캐싱하는 것이 약간이나마 도움이 될 수 있다. 그러나 상황에 따라 다르겠지만 아마도 [백그라운드 싱크](https://github.com/WICG/BackgroundSync/blob/master/explainer.md)를 이용하여, 사용자가 다시 왔을 때 콘텐츠를 즉시 보여주는 것이 좋을 것이다.

트랜잭션 사이트와 마찬가지로, 소셜 사이트도 설치가 돼야 시스템 API에 접근하여 혜택을 누릴 수 있다. 예를 들어 대부분의 소셜 네트워크는 동일한 서비스를 이용하는 친구나 동료를 찾아주기 위해 연락처로의 접근 권한을 요청한다. 물론 우리의 서비스를 알린다는 명목 하에 사용자의 친구들에게 스팸을 보내는 용도로 권한을 악용하면 안 된다. 사용자와 그 개인 정보를 존중하지 않는다면 결국 모든 것을 잃게 될 것이다.

 

* 소프트웨어

PWA의 마법은 이와 같은 서비스형 소프트웨어Software as a Service(SaaS)를 그 자체로 완전한 데스크톱(또는 모바일) 애플리케이션으로 만들어 준다. 따라서 지금까지 웹 기술에만 올인했던 팀이라 할지라도 PWA를 통해 네이티브 플랫폼 설치 기능도 제공하게 됨으로써, 여전히 자기 고유의 영역에 대한 투자를 지속하거나 확대할 수 있게 됐다. 물론 네이티브 소프트웨어 제작을 해야 하는 몇 가지 확고한 이유는 분명 있다. 그러나 대부분의 경우 애플리케이션에서 필요한 모든 기능은 웹에서도 제공된다. 이것이 웹 방식으로 먼저 시작하는 이유다.

오프라인 데이터 저장소, 백그라운드 동기화, 파일 시스템 접근 능력도 역시 사용자 경험을 한층 더 증진시킬 것이다. 따라서 소셜 서비스는 프로그레시브 웹 앱의 가장 큰 수혜자라 할 수 있다.

 

* 기관 사이트

어떤 프로젝트는 여러 방면에 걸쳐 있는 것이 많아서 하나의 원형으로 분류하기 힘들다. 학교, 대기업, 거대 금융기관 등의 프로젝트가 그렇다. 이는 여러 원형의 혼합된 형태로, 각 원형에서의 이점이 모두 누적된다.

대형 기관의 프로젝트의 경우 PWA를 적용하기 위한 중요한 전략을 어떻게 구성할지 판단하기 어려울 수도 있다. 그러나 꼭 그럴 필요는 없다. 프로젝트를 여러 개의 독립적인 PWA로 나누는 방법도 있기 때문이다.

온라인 교육 시스템을 예로 들어 보자. 교육 시스템 자체를 하나의 PWA로 만들 수도 있지만, 개별 과정으로 쪼개어 각각 설치 가능한 PWA로 만들 수도 있다. 그렇게 할 수 있는 이유는 서비스 워커와 웹 앱 매니페스트의 적용 영역을 정할 수 있기 때문이다. 예컨대 특정 호스트 이름으로 범위를 정할 수도 있으며, 또는 URL의 특정 경로로만 한정할 수도 있다. 분명히 복잡해 보이긴 하지만, 각 과정을 하나의 교육 과정 템플릿이라고 하고 웹 앱 매니페스트와 서비스 워커를 그 템플릿의 일부라고 생각하면 감을 잡기 쉬울 것이다.