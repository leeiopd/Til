# 패스트캠퍼스 - AWS 인프라 구축과 DevOps 운영 초격차 패키지

## Part2. AWS 기반 소규모 & 중규모 아키텍트 설계

### 01. AWS 기초와 VPC

#### 11_(VPC) Bastion Host 만들기



#####  Bastion Host

* VPN 의 Private Subnet 에서 Public Subnet 을 이용하여 외부 네트워크 사이에서 게이트 역할을 수행



##### Bastion Host 만들기

* Public EC2(Bastion Host) 만들기
* Private EC2 만들기
* Bastion Host 를 통해 Private EC2 로 접근하기



##### Public EC2(Bastion Host) 만들기

* Public EC2 생성

  * 단계 1: Amazone Machine Image(AMI) 선택 - Amazone Linux 2 AMI / 64비트

  * 단계 2: 인스턴스 유형 선택 - t2.micro (프리티어 사용 가능)

  * 단계 3: 인스턴스 세부 정보 구성

    * 인스턴스 개수 - 1
    * 네트워크 - 실습용 fastcampus-vpc
    * 서브넷 - 실습용 fastcampus-subnet-public
    * 퍼블릭 IP 자동 할당 - 서브넷 사용 설정(활성화)
      * Public Subnet 설정: 퍼블릭 IPv4 주소 자동 할당 활성화
      * EC2 에 접근하기 위한 Public IP 주소를 할당 하는 설정
        * 인터넷에서 인스턴스에 연결할 수 있도록 Amazon의 퍼블릭 IP 주소 풀에서 퍼블릭 IP 주소를 요청
        * 대부분의 경우 퍼블릭 IP 주소는 중지되거나 종료되어 더 이상 사용할 수 없게 될 때까지 인스턴스와 연결된 상태로 유지

  * 단계 4: 스토리지 추가

    | 볼륨유형 | 디바이스  | 스냅샷  | 크기(GIB) | 볼륨 유형 | IOPS           | 처리량         | 종료시 삭제 | 암호화 |
    | -------- | --------- | ------- | --------- | --------- | -------------- | -------------- | ----------- | ------ |
    | 루트     | /dev/xvda | ******* | 8(기본)   | 마그네틱  | 해당 사항 없음 | 해당 사항 없음 | v           |        |

  * 단계 5: 태그 추가

    | 키   | 값         | 인스턴스 | 볼륨 | 네트워크 인터페이스 |
    | ---- | ---------- | -------- | ---- | ------------------- |
    | Name | public_ec2 | v        | v    | v                   |

  * 단계 6: 보안 그룹 구성

    * 보안 그룹 할당 - 새 보안 그룹 생성
    * 보안 그룹 이름 - public-sg
    * 설명 - public-sg

    |      | 유형             | 프로토콜 | 포트범위  | 소스                    | 설명 |
    | ---- | ---------------- | -------- | --------- | ----------------------- | ---- |
    | 기본 | SSH              | TCP      | 22        | 사용자 지정 - 0.0.0.0/0 |      |
    | 추가 | 모든 ICMP - IPv4 | ICMP     | 0 - 65535 | 사용자 지정 - 0.0.0.0/0 |      |

  * 검토 및 시작

  * 범용(SSD)에서 부팅 - 범용(SSD)을 콘솔에서 시작하는 모든 인스턴스의 기본 부트 볼륨으로 설정(권장)

  * 단계 7: 인스턴스 시작 검토

* Private EC2 생성

  * 단계 1: Amazone Machine Image(AMI) 선택 - Amazone Linux 2 AMI / 64비트

  * 단계 2: 인스턴스 유형 선택 - t2.micro (프리티어 사용 가능)

  * 단계 3: 인스턴스 세부 정보 구성

    * 인스턴스 개수 - 1
    * 네트워크 - 실습용 fastcampus-vpc
    * 서브넷 - 실습용 fastcampus-subnet-private
    * 퍼블릭 IP 자동 할당 - 서브넷 사용 설정(비활성화)

  * 단계 4: 스토리지 추가

    | 볼륨유형 | 디바이스  | 스냅샷  | 크기(GIB) | 볼륨 유형 | IOPS           | 처리량         | 종료시 삭제 | 암호화 |
    | -------- | --------- | ------- | --------- | --------- | -------------- | -------------- | ----------- | ------ |
    | 루트     | /dev/xvda | ******* | 8(기본)   | 마그네틱  | 해당 사항 없음 | 해당 사항 없음 | v           |        |

  * 단계 5: 태그 추가

    | 키   | 값          | 인스턴스 | 볼륨 | 네트워크 인터페이스 |
    | ---- | ----------- | -------- | ---- | ------------------- |
    | Name | private_ec2 | v        | v    | v                   |

  * 단계 6: 보안 그룹 구성

    * 보안 그룹 할당 - 새 보안 그룹 생성
    * 보안 그룹 이름 - private-sg
    * 설명 - private-sg

    |      | 유형             | 프로토콜 | 포트범위  | 소스      | 설명 |
    | ---- | ---------------- | -------- | --------- | --------- | ---- |
    | 기본 | SSH              | TCP      | 22        | public-sg |      |
    | 추가 | 모든 ICMP - IPv4 | ICMP     | 0 - 65535 | public-sg |      |

    * private 는 public 네트워크만 연결되도록 설정
      * Inbound / Outbound

  * 검토 및 시작

  * 범용(SSD)에서 부팅 - 범용(SSD)을 콘솔에서 시작하는 모든 인스턴스의 기본 부트 볼륨으로 설정(권장)

  * 단계 7: 인스턴스 시작 검토



##### Public EC2 접속

* ```bash
  $ ssh -i public-ec2-keypair.pem ec2-user@3.35.220.41
  ```

  * WARNING: UNPROTECTED PRIVATE KEY FILE! 에러 발생 시

    * private key 의 퍼미션이 644로 권한이 너무 공개되어 있어서 발생

    * ```bash
      $ chomd 400 xxx.pem
      ```

      * 읽기 권한으로 업데이트 해준다.



##### Private EC2 접속

* 퍼블릭 IP 주소가 할당되어 있지 않음으로 외부에서 접근이 불가능하다.

* Public 을 통해 프라이빗 IP 로 접근

  * Public EC2 접속 상태에서 시작

  * public EC2 에 private key 파일을 저장

  * ```bash
    $ ssh -i "private-ec2-keypair.pem" "private_ec2의 프라이빗 IP 주소"
    ```

  * 콘솔창의 ip 주소가 바뀌며, 접속 완료